# Expandable FAB Menu - Quick PRD & Technical Spec

## Overview

Add a floating action button (FAB) to Shelf Detail View that expands to show "Scan ISBN" and "Add Book" options, providing quick access to the most common actions.

---

## Product Requirements

### Behavior

1. **Collapsed State**: Single blue circular button with "+" icon
2. **Expanded State**: Shows two options above the main button:
    - "Scan ISBN" with barcode icon
    - "Add Book" with plus icon
3. **Interaction**: Tap main button to expand/collapse
4. **Animation**: Smooth spring animation
5. **Backdrop**: Semi-transparent overlay when expanded (tap to close)

### Why Not Bottom Nav Bar?

- App only has 2 main screens (Shelves List ‚Üí Shelf Detail)
- Bottom nav typically needs 3-5 tabs to justify the space
- FAB is more flexible and iOS-appropriate for this use case
- Keeps focus on the content, not navigation chrome

---

## Design Decision: iOS-Native Approach

### Option A: Expandable FAB (RECOMMENDED)

**Pros:**

- Familiar pattern from many iOS apps (Apple Notes, Reminders)
- Doesn't permanently consume screen space
- Clear visual hierarchy
- Works well with existing UI

**Cons:**

- Requires custom implementation
- Covers content when expanded

### Option B: Bottom Sheet Menu

**Pros:**

- Very iOS-native (uses `.sheet()`)
- Already have sheet patterns in app

**Cons:**

- Extra tap (button ‚Üí sheet ‚Üí option)
- Covers entire screen

**Decision: Option A** - More efficient, better UX for frequently-used actions

---

## Implementation

### 1. Expandable FAB Component

```swift
// ExpandableFAB.swift
import SwiftUI

struct ExpandableFAB: View {
    @Binding var isExpanded: Bool
    let onScanISBN: () -> Void
    let onAddBook: () -> Void
    
    var body: some View {
        VStack(alignment: .trailing, spacing: 16) {
            // Expanded options (shown when isExpanded = true)
            if isExpanded {
                // Option 1: Scan ISBN
                FABOption(
                    icon: "barcode.viewfinder",
                    label: "Scan ISBN",
                    color: .green
                ) {
                    isExpanded = false
                    onScanISBN()
                }
                .transition(.scale.combined(with: .opacity))
                
                // Option 2: Add Book
                FABOption(
                    icon: "plus",
                    label: "Add Book",
                    color: .orange
                ) {
                    isExpanded = false
                    onAddBook()
                }
                .transition(.scale.combined(with: .opacity))
            }
            
            // Main FAB button
            Button {
                withAnimation(.spring(response: 0.3, dampingFraction: 0.7)) {
                    isExpanded.toggle()
                }
            } label: {
                Image(systemName: isExpanded ? "xmark" : "plus")
                    .font(.title2)
                    .fontWeight(.semibold)
                    .foregroundColor(.white)
                    .frame(width: 60, height: 60)
                    .background(Color.blue)
                    .clipShape(Circle())
                    .rotationEffect(.degrees(isExpanded ? 45 : 0))
                    .shadow(radius: 4, x: 0, y: 4)
            }
        }
        .padding()
    }
}

// Individual FAB option button
struct FABOption: View {
    let icon: String
    let label: String
    let color: Color
    let action: () -> Void
    
    var body: some View {
        Button(action: action) {
            HStack(spacing: 12) {
                Text(label)
                    .font(.subheadline)
                    .fontWeight(.medium)
                    .foregroundColor(.primary)
                    .padding(.horizontal, 12)
                    .padding(.vertical, 8)
                    .background(
                        RoundedRectangle(cornerRadius: 8)
                            .fill(Color(.systemBackground))
                            .shadow(radius: 2)
                    )
                
                Image(systemName: icon)
                    .font(.title3)
                    .fontWeight(.semibold)
                    .foregroundColor(.white)
                    .frame(width: 50, height: 50)
                    .background(color)
                    .clipShape(Circle())
                    .shadow(radius: 3, x: 0, y: 2)
            }
        }
    }
}

// Preview
#Preview {
    ZStack {
        Color.gray.opacity(0.1)
            .ignoresSafeArea()
        
        VStack {
            Spacer()
            HStack {
                Spacer()
                ExpandableFAB(
                    isExpanded: .constant(true),
                    onScanISBN: {},
                    onAddBook: {}
                )
            }
        }
    }
}
```

### 2. Update ShelfDetailView

```swift
// Update ShelfDetailView to use FAB

struct ShelfDetailView: View {
    let shelf: Shelf
    
    @StateObject private var supabase = SupabaseService.shared
    @State private var books: [Book] = []
    @State private var isLoading = false
    @State private var showAddBook = false
    @State private var showScanner = false
    @State private var showEditShelf = false
    @State private var isFABExpanded = false  // NEW
    @State private var errorMessage: String?
    @State private var showError = false
    @Environment(\.dismiss) private var dismiss
    
    var body: some View {
        ZStack {
            // Main content
            Group {
                if isLoading {
                    ProgressView()
                } else if books.isEmpty {
                    ContentUnavailableView(
                        "No Books Yet",
                        systemImage: "book.closed",
                        description: Text("Add your first book to this shelf")
                    )
                } else {
                    List {
                        ForEach(books) { book in
                            NavigationLink(destination: BookDetailView(book: book)) {
                                VStack(alignment: .leading, spacing: 4) {
                                    Text(book.title)
                                        .font(.headline)
                                    if let author = book.author, !author.isEmpty {
                                        Text(author)
                                            .font(.subheadline)
                                            .foregroundStyle(.secondary)
                                    }
                                }
                            }
                        }
                        .onDelete(perform: deleteBook)
                    }
                }
            }
            
            // Semi-transparent backdrop when FAB is expanded
            if isFABExpanded {
                Color.black.opacity(0.2)
                    .ignoresSafeArea()
                    .onTapGesture {
                        withAnimation(.spring(response: 0.3, dampingFraction: 0.7)) {
                            isFABExpanded = false
                        }
                    }
                    .transition(.opacity)
            }
            
            // Expandable FAB
            VStack {
                Spacer()
                HStack {
                    Spacer()
                    ExpandableFAB(
                        isExpanded: $isFABExpanded,
                        onScanISBN: {
                            showScanner = true
                        },
                        onAddBook: {
                            showAddBook = true
                        }
                    )
                }
            }
        }
        .navigationTitle(shelf.name)
        .navigationBarTitleDisplayMode(.large)
        .toolbar {
            ToolbarItem(placement: .topBarTrailing) {
                Menu {
                    // Keep these as secondary actions
                    Button {
                        showEditShelf = true
                    } label: {
                        Label("Edit Shelf", systemImage: "pencil")
                    }
                    
                    // Optional: keep these here too for discoverability
                    Divider()
                    
                    Button {
                        showScanner = true
                        isFABExpanded = false
                    } label: {
                        Label("Scan ISBN", systemImage: "barcode.viewfinder")
                    }
                    
                    Button {
                        showAddBook = true
                        isFABExpanded = false
                    } label: {
                        Label("Add Book Manually", systemImage: "plus")
                    }
                } label: {
                    Image(systemName: "ellipsis.circle")
                }
            }
        }
        .refreshable {
            await loadBooks()
        }
        .sheet(isPresented: $showAddBook) {
            AddBookView(defaultShelfId: shelf.id, onSave: {
                await loadBooks()
            })
        }
        .sheet(isPresented: $showScanner) {
            ISBNScannerView { isbn in
                Task {
                    await handleScannedISBN(isbn)
                }
            }
        }
        .sheet(isPresented: $showEditShelf) {
            EditShelfView(shelf: shelf, onUpdate: {
                dismiss()
            })
        }
        .alert("Error", isPresented: $showError) {
            Button("OK", role: .cancel) { }
        } message: {
            Text(errorMessage ?? "An error occurred")
        }
        .task {
            await loadBooks()
        }
    }
    
    // ... rest of the methods remain the same
}
```

### 3. Alternative: Simpler Version Without Labels

If you want something even more minimal:

```swift
struct SimpleFAB: View {
    @Binding var isExpanded: Bool
    let onScanISBN: () -> Void
    let onAddBook: () -> Void
    
    var body: some View {
        VStack(spacing: 16) {
            if isExpanded {
                // Scan ISBN button
                Button {
                    isExpanded = false
                    onScanISBN()
                } label: {
                    Image(systemName: "barcode.viewfinder")
                        .font(.title3)
                        .fontWeight(.semibold)
                        .foregroundColor(.white)
                        .frame(width: 50, height: 50)
                        .background(Color.green)
                        .clipShape(Circle())
                        .shadow(radius: 3)
                }
                .transition(.scale.combined(with: .opacity))
                
                // Add Book button
                Button {
                    isExpanded = false
                    onAddBook()
                } label: {
                    Image(systemName: "text.badge.plus")
                        .font(.title3)
                        .fontWeight(.semibold)
                        .foregroundColor(.white)
                        .frame(width: 50, height: 50)
                        .background(Color.orange)
                        .clipShape(Circle())
                        .shadow(radius: 3)
                }
                .transition(.scale.combined(with: .opacity))
            }
            
            // Main button
            Button {
                withAnimation(.spring(response: 0.3, dampingFraction: 0.7)) {
                    isExpanded.toggle()
                }
            } label: {
                Image(systemName: isExpanded ? "xmark" : "plus")
                    .font(.title2)
                    .fontWeight(.semibold)
                    .foregroundColor(.white)
                    .frame(width: 60, height: 60)
                    .background(Color.blue)
                    .clipShape(Circle())
                    .rotationEffect(.degrees(isExpanded ? 45 : 0))
                    .shadow(radius: 4)
            }
        }
        .padding()
    }
}
```

---

## Visual Design

### Collapsed State

```
                    [+]  ‚Üê Blue circle, 60x60
                         Bottom-right corner
```

### Expanded State

```
    "Scan ISBN"  [üì∑]  ‚Üê Green circle, 50x50
                   ‚Üë
    "Add Book"   [+]   ‚Üê Orange circle, 50x50
                   ‚Üë
                  [√ó]   ‚Üê Blue circle, 60x60
                         (Plus rotates to X)
```

### Colors

- **Main FAB**: `.blue` (system blue)
- **Scan ISBN**: `.green`
- **Add Book**: `.orange`
- **Backdrop**: `.black.opacity(0.2)`

---

## User Experience

### Interaction Flow

1. User taps main FAB (+)
2. Button rotates 45¬∞ to become (√ó)
3. Two options spring up from below with spring animation
4. User taps an option OR taps backdrop/main button to close
5. If option tapped: FAB collapses, action executes
6. If backdrop/main tapped: FAB collapses, no action

### Animations

- **Duration**: 0.3 seconds
- **Curve**: Spring (response: 0.3, damping: 0.7)
- **Effects**:
    - Scale + opacity for options
    - Rotation for main button icon
    - Fade for backdrop

---

## Pros & Cons

### Pros

‚úÖ Quick access to most common actions  
‚úÖ Doesn't permanently use screen space  
‚úÖ Visually distinct from toolbar  
‚úÖ Familiar pattern for iOS users  
‚úÖ Animations feel native and smooth  
‚úÖ Can still access via menu for discoverability

### Cons

‚ùå Covers content when expanded  
‚ùå Custom implementation (not built-in)  
‚ùå Might not be immediately discoverable  
‚ùå Adds visual weight to the screen

---

## Alternatives Considered

### 1. Keep in Menu Only

**Verdict**: Less accessible for primary actions

### 2. Bottom Sheet

**Verdict**: Extra tap, slower workflow

### 3. Toolbar Buttons (Top)

**Verdict**: Already crowded with title and menu

### 4. Tab Bar (Bottom)

**Verdict**: Overkill for 2-screen app

---

## Recommendation

**Use the Expandable FAB with labels** (`ExpandableFAB` component) because:

- Labels make it discoverable
- Colored circles provide visual hierarchy
- Smooth animations feel premium
- Doesn't require learning new navigation patterns
- Easy to remove if users don't like it

**Keep actions in menu too** for:

- Discoverability
- Users who prefer menus
- Accessibility

---

## Testing Checklist

- [ ] FAB appears on Shelf Detail only
- [ ] Expands/collapses smoothly
- [ ] Backdrop dismisses when tapped
- [ ] Scan ISBN opens scanner
- [ ] Add Book opens form
- [ ] FAB auto-closes after selection
- [ ] Doesn't interfere with list scrolling
- [ ] Works with empty state
- [ ] Works with VoiceOver
- [ ] Position respects safe area

---

## Implementation Time

- Create FAB components: **30 minutes**
- Integrate into ShelfDetailView: **15 minutes**
- Testing and polish: **15 minutes**
- **Total: 1 hour**

Please implement everything below.
## All 7 Screens (beyond auth):

### 1. **ShelvesListView** (Home Screen)

- List of all user's shelves
- Swipe to delete with confirmation
- Pull to refresh
- Logout button
- Add shelf button
- Empty state when no shelves

### 2. **ShelfDetailView**

- Shows all books on a shelf
- Swipe to delete books
- Menu with "Add Book" and "Edit Shelf" options
- Pull to refresh
- Empty state when no books

### 3. **BookDetailView**

- Displays book title, author, and current shelf
- "Move to Shelf" button (opens shelf picker)
- "Edit Book" button
- "Delete Book" button with confirmation dialog
- Clean, card-style layout

### 4. **AddBookView**

- Form with title, author (optional), and shelf picker
- Pre-selects the current shelf if coming from ShelfDetailView
- Validation (title required)
- Save/Cancel buttons

### 5. **EditBookView**

- Pre-populated form with existing book data
- Can change title, author, and shelf
- Update/Cancel buttons

### 6. **AddShelfView**

- Simple form with shelf name field
- Validation (name required)
- Save/Cancel buttons

### 7. **EditShelfView**

- Pre-populated with existing shelf name
- Update/Cancel buttons

### Bonus: **MoveToShelfView**

- List of all shelves with checkmark on current
- Tap to select new shelf
- Move/Cancel buttons
- Disabled if selecting the same shelf

## Features Throughout:

✅ **Loading states** - Progress indicators during async operations ✅ **Error handling** - Alerts for all errors with user-friendly messages ✅ **Form validation** - Buttons disabled until forms are valid ✅ **Empty states** - ContentUnavailableView when lists are empty ✅ **Pull to refresh** - On all list views ✅ **Swipe to delete** - On shelves and books lists ✅ **Confirmation dialogs** - For destructive actions ✅ **Navigation** - Proper NavigationStack and sheet presentations ✅ **Callbacks** - Parent views refresh after child actions

## How Everything Connects:

1. User logs in → **AuthView** → **ShelvesListView**
2. Tap shelf → **ShelfDetailView**
3. Tap book → **BookDetailView**
4. All CRUD operations go through **SupabaseService**
5. All views handle errors gracefully
6. All forms validate before submission

```swift
// MARK: - 1. Shelves List View (Home Screen)

import SwiftUI

struct ShelvesListView: View {
    @StateObject private var supabase = SupabaseService.shared
    @State private var shelves: [Shelf] = []
    @State private var isLoading = false
    @State private var showAddShelf = false
    @State private var errorMessage: String?
    @State private var showError = false
    
    var body: some View {
        NavigationStack {
            Group {
                if isLoading {
                    ProgressView()
                } else if shelves.isEmpty {
                    ContentUnavailableView(
                        "No Shelves Yet",
                        systemImage: "books.vertical",
                        description: Text("Create your first shelf to start organizing your books")
                    )
                } else {
                    List {
                        ForEach(shelves) { shelf in
                            NavigationLink(destination: ShelfDetailView(shelf: shelf)) {
                                HStack {
                                    Image(systemName: "books.vertical")
                                        .foregroundStyle(.blue)
                                    Text(shelf.name)
                                        .font(.headline)
                                }
                            }
                        }
                        .onDelete(perform: deleteShelf)
                    }
                }
            }
            .navigationTitle("My Shelves")
            .toolbar {
                ToolbarItem(placement: .topBarLeading) {
                    Button {
                        signOut()
                    } label: {
                        Image(systemName: "rectangle.portrait.and.arrow.right")
                    }
                }
                
                ToolbarItem(placement: .topBarTrailing) {
                    Button {
                        showAddShelf = true
                    } label: {
                        Image(systemName: "plus")
                    }
                }
            }
            .refreshable {
                await loadShelves()
            }
            .sheet(isPresented: $showAddShelf) {
                AddShelfView(onSave: {
                    await loadShelves()
                })
            }
            .alert("Error", isPresented: $showError) {
                Button("OK", role: .cancel) { }
            } message: {
                Text(errorMessage ?? "An error occurred")
            }
            .task {
                await loadShelves()
            }
        }
    }
    
    private func loadShelves() async {
        isLoading = true
        do {
            shelves = try await supabase.fetchShelves()
        } catch {
            errorMessage = error.localizedDescription
            showError = true
        }
        isLoading = false
    }
    
    private func deleteShelf(at offsets: IndexSet) {
        Task {
            for index in offsets {
                let shelf = shelves[index]
                do {
                    try await supabase.deleteShelf(id: shelf.id)
                    await loadShelves()
                } catch {
                    errorMessage = error.localizedDescription
                    showError = true
                }
            }
        }
    }
    
    private func signOut() {
        Task {
            do {
                try await supabase.signOut()
            } catch {
                errorMessage = error.localizedDescription
                showError = true
            }
        }
    }
}

// MARK: - 2. Shelf Detail View

struct ShelfDetailView: View {
    let shelf: Shelf
    
    @StateObject private var supabase = SupabaseService.shared
    @State private var books: [Book] = []
    @State private var isLoading = false
    @State private var showAddBook = false
    @State private var showEditShelf = false
    @State private var errorMessage: String?
    @State private var showError = false
    @Environment(\.dismiss) private var dismiss
    
    var body: some View {
        Group {
            if isLoading {
                ProgressView()
            } else if books.isEmpty {
                ContentUnavailableView(
                    "No Books Yet",
                    systemImage: "book.closed",
                    description: Text("Add your first book to this shelf")
                )
            } else {
                List {
                    ForEach(books) { book in
                        NavigationLink(destination: BookDetailView(book: book)) {
                            VStack(alignment: .leading, spacing: 4) {
                                Text(book.title)
                                    .font(.headline)
                                if let author = book.author, !author.isEmpty {
                                    Text(author)
                                        .font(.subheadline)
                                        .foregroundStyle(.secondary)
                                }
                            }
                        }
                    }
                    .onDelete(perform: deleteBook)
                }
            }
        }
        .navigationTitle(shelf.name)
        .navigationBarTitleDisplayMode(.large)
        .toolbar {
            ToolbarItem(placement: .topBarTrailing) {
                Menu {
                    Button {
                        showAddBook = true
                    } label: {
                        Label("Add Book", systemImage: "plus")
                    }
                    
                    Button {
                        showEditShelf = true
                    } label: {
                        Label("Edit Shelf", systemImage: "pencil")
                    }
                } label: {
                    Image(systemName: "ellipsis.circle")
                }
            }
        }
        .refreshable {
            await loadBooks()
        }
        .sheet(isPresented: $showAddBook) {
            AddBookView(defaultShelfId: shelf.id, onSave: {
                await loadBooks()
            })
        }
        .sheet(isPresented: $showEditShelf) {
            EditShelfView(shelf: shelf, onUpdate: {
                dismiss()
            })
        }
        .alert("Error", isPresented: $showError) {
            Button("OK", role: .cancel) { }
        } message: {
            Text(errorMessage ?? "An error occurred")
        }
        .task {
            await loadBooks()
        }
    }
    
    private func loadBooks() async {
        isLoading = true
        do {
            books = try await supabase.fetchBooks(shelfId: shelf.id)
        } catch {
            errorMessage = error.localizedDescription
            showError = true
        }
        isLoading = false
    }
    
    private func deleteBook(at offsets: IndexSet) {
        Task {
            for index in offsets {
                let book = books[index]
                do {
                    try await supabase.deleteBook(id: book.id)
                    await loadBooks()
                } catch {
                    errorMessage = error.localizedDescription
                    showError = true
                }
            }
        }
    }
}

// MARK: - 3. Book Detail View

struct BookDetailView: View {
    let book: Book
    
    @StateObject private var supabase = SupabaseService.shared
    @State private var shelves: [Shelf] = []
    @State private var showEditBook = false
    @State private var showMoveToShelf = false
    @State private var showDeleteConfirmation = false
    @State private var errorMessage: String?
    @State private var showError = false
    @Environment(\.dismiss) private var dismiss
    
    var body: some View {
        ScrollView {
            VStack(alignment: .leading, spacing: 24) {
                // Book Title
                VStack(alignment: .leading, spacing: 8) {
                    Text("Title")
                        .font(.caption)
                        .foregroundStyle(.secondary)
                        .textCase(.uppercase)
                    Text(book.title)
                        .font(.title2)
                        .fontWeight(.bold)
                }
                
                // Author
                if let author = book.author, !author.isEmpty {
                    VStack(alignment: .leading, spacing: 8) {
                        Text("Author")
                            .font(.caption)
                            .foregroundStyle(.secondary)
                            .textCase(.uppercase)
                        Text(author)
                            .font(.title3)
                    }
                }
                
                // Current Shelf
                VStack(alignment: .leading, spacing: 8) {
                    Text("Current Shelf")
                        .font(.caption)
                        .foregroundStyle(.secondary)
                        .textCase(.uppercase)
                    if let shelf = shelves.first(where: { $0.id == book.shelfId }) {
                        Text(shelf.name)
                            .font(.body)
                    }
                }
                
                Spacer()
                
                // Action Buttons
                VStack(spacing: 12) {
                    Button {
                        showMoveToShelf = true
                    } label: {
                        Label("Move to Shelf", systemImage: "arrow.right.square")
                            .frame(maxWidth: .infinity)
                    }
                    .buttonStyle(.bordered)
                    .controlSize(.large)
                    
                    Button {
                        showEditBook = true
                    } label: {
                        Label("Edit Book", systemImage: "pencil")
                            .frame(maxWidth: .infinity)
                    }
                    .buttonStyle(.bordered)
                    .controlSize(.large)
                    
                    Button(role: .destructive) {
                        showDeleteConfirmation = true
                    } label: {
                        Label("Delete Book", systemImage: "trash")
                            .frame(maxWidth: .infinity)
                    }
                    .buttonStyle(.bordered)
                    .controlSize(.large)
                }
            }
            .padding()
        }
        .navigationTitle("Book Details")
        .navigationBarTitleDisplayMode(.inline)
        .sheet(isPresented: $showEditBook) {
            EditBookView(book: book, shelves: shelves, onUpdate: {
                dismiss()
            })
        }
        .sheet(isPresented: $showMoveToShelf) {
            MoveToShelfView(book: book, shelves: shelves, onMove: {
                dismiss()
            })
        }
        .confirmationDialog("Delete Book", isPresented: $showDeleteConfirmation) {
            Button("Delete", role: .destructive) {
                deleteBook()
            }
        } message: {
            Text("Are you sure you want to delete \"\(book.title)\"?")
        }
        .alert("Error", isPresented: $showError) {
            Button("OK", role: .cancel) { }
        } message: {
            Text(errorMessage ?? "An error occurred")
        }
        .task {
            await loadShelves()
        }
    }
    
    private func loadShelves() async {
        do {
            shelves = try await supabase.fetchShelves()
        } catch {
            errorMessage = error.localizedDescription
            showError = true
        }
    }
    
    private func deleteBook() {
        Task {
            do {
                try await supabase.deleteBook(id: book.id)
                dismiss()
            } catch {
                errorMessage = error.localizedDescription
                showError = true
            }
        }
    }
}

// MARK: - 4. Add Book View

struct AddBookView: View {
    let defaultShelfId: UUID?
    let onSave: () async -> Void
    
    @StateObject private var supabase = SupabaseService.shared
    @State private var title = ""
    @State private var author = ""
    @State private var selectedShelfId: UUID?
    @State private var shelves: [Shelf] = []
    @State private var isLoading = false
    @State private var errorMessage: String?
    @State private var showError = false
    @Environment(\.dismiss) private var dismiss
    
    var body: some View {
        NavigationStack {
            Form {
                Section {
                    TextField("Title", text: $title)
                    TextField("Author (optional)", text: $author)
                }
                
                Section {
                    Picker("Shelf", selection: $selectedShelfId) {
                        Text("Select a shelf").tag(nil as UUID?)
                        ForEach(shelves) { shelf in
                            Text(shelf.name).tag(shelf.id as UUID?)
                        }
                    }
                }
            }
            .navigationTitle("Add Book")
            .navigationBarTitleDisplayMode(.inline)
            .toolbar {
                ToolbarItem(placement: .cancellationAction) {
                    Button("Cancel") {
                        dismiss()
                    }
                }
                
                ToolbarItem(placement: .confirmationAction) {
                    Button("Save") {
                        saveBook()
                    }
                    .disabled(!isFormValid || isLoading)
                }
            }
            .alert("Error", isPresented: $showError) {
                Button("OK", role: .cancel) { }
            } message: {
                Text(errorMessage ?? "An error occurred")
            }
            .task {
                await loadShelves()
                selectedShelfId = defaultShelfId
            }
        }
    }
    
    private var isFormValid: Bool {
        !title.isEmpty && selectedShelfId != nil
    }
    
    private func loadShelves() async {
        do {
            shelves = try await supabase.fetchShelves()
        } catch {
            errorMessage = error.localizedDescription
            showError = true
        }
    }
    
    private func saveBook() {
        guard let shelfId = selectedShelfId else { return }
        
        isLoading = true
        Task {
            do {
                _ = try await supabase.createBook(
                    title: title,
                    author: author.isEmpty ? nil : author,
                    shelfId: shelfId
                )
                await onSave()
                dismiss()
            } catch {
                errorMessage = error.localizedDescription
                showError = true
            }
            isLoading = false
        }
    }
}

// MARK: - 5. Edit Book View

struct EditBookView: View {
    let book: Book
    let shelves: [Shelf]
    let onUpdate: () -> Void
    
    @StateObject private var supabase = SupabaseService.shared
    @State private var title: String
    @State private var author: String
    @State private var selectedShelfId: UUID
    @State private var isLoading = false
    @State private var errorMessage: String?
    @State private var showError = false
    @Environment(\.dismiss) private var dismiss
    
    init(book: Book, shelves: [Shelf], onUpdate: @escaping () -> Void) {
        self.book = book
        self.shelves = shelves
        self.onUpdate = onUpdate
        _title = State(initialValue: book.title)
        _author = State(initialValue: book.author ?? "")
        _selectedShelfId = State(initialValue: book.shelfId)
    }
    
    var body: some View {
        NavigationStack {
            Form {
                Section {
                    TextField("Title", text: $title)
                    TextField("Author (optional)", text: $author)
                }
                
                Section {
                    Picker("Shelf", selection: $selectedShelfId) {
                        ForEach(shelves) { shelf in
                            Text(shelf.name).tag(shelf.id)
                        }
                    }
                }
            }
            .navigationTitle("Edit Book")
            .navigationBarTitleDisplayMode(.inline)
            .toolbar {
                ToolbarItem(placement: .cancellationAction) {
                    Button("Cancel") {
                        dismiss()
                    }
                }
                
                ToolbarItem(placement: .confirmationAction) {
                    Button("Update") {
                        updateBook()
                    }
                    .disabled(!isFormValid || isLoading)
                }
            }
            .alert("Error", isPresented: $showError) {
                Button("OK", role: .cancel) { }
            } message: {
                Text(errorMessage ?? "An error occurred")
            }
        }
    }
    
    private var isFormValid: Bool {
        !title.isEmpty
    }
    
    private func updateBook() {
        isLoading = true
        Task {
            do {
                try await supabase.updateBook(
                    id: book.id,
                    title: title,
                    author: author.isEmpty ? nil : author,
                    shelfId: selectedShelfId
                )
                onUpdate()
                dismiss()
            } catch {
                errorMessage = error.localizedDescription
                showError = true
            }
            isLoading = false
        }
    }
}

// MARK: - 6. Add Shelf View

struct AddShelfView: View {
    let onSave: () async -> Void
    
    @StateObject private var supabase = SupabaseService.shared
    @State private var name = ""
    @State private var isLoading = false
    @State private var errorMessage: String?
    @State private var showError = false
    @Environment(\.dismiss) private var dismiss
    
    var body: some View {
        NavigationStack {
            Form {
                Section {
                    TextField("Shelf Name", text: $name)
                }
            }
            .navigationTitle("Add Shelf")
            .navigationBarTitleDisplayMode(.inline)
            .toolbar {
                ToolbarItem(placement: .cancellationAction) {
                    Button("Cancel") {
                        dismiss()
                    }
                }
                
                ToolbarItem(placement: .confirmationAction) {
                    Button("Save") {
                        saveShelf()
                    }
                    .disabled(!isFormValid || isLoading)
                }
            }
            .alert("Error", isPresented: $showError) {
                Button("OK", role: .cancel) { }
            } message: {
                Text(errorMessage ?? "An error occurred")
            }
        }
    }
    
    private var isFormValid: Bool {
        !name.isEmpty
    }
    
    private func saveShelf() {
        isLoading = true
        Task {
            do {
                _ = try await supabase.createShelf(name: name)
                await onSave()
                dismiss()
            } catch {
                errorMessage = error.localizedDescription
                showError = true
            }
            isLoading = false
        }
    }
}

// MARK: - 7. Edit Shelf View

struct EditShelfView: View {
    let shelf: Shelf
    let onUpdate: () -> Void
    
    @StateObject private var supabase = SupabaseService.shared
    @State private var name: String
    @State private var isLoading = false
    @State private var errorMessage: String?
    @State private var showError = false
    @Environment(\.dismiss) private var dismiss
    
    init(shelf: Shelf, onUpdate: @escaping () -> Void) {
        self.shelf = shelf
        self.onUpdate = onUpdate
        _name = State(initialValue: shelf.name)
    }
    
    var body: some View {
        NavigationStack {
            Form {
                Section {
                    TextField("Shelf Name", text: $name)
                }
            }
            .navigationTitle("Edit Shelf")
            .navigationBarTitleDisplayMode(.inline)
            .toolbar {
                ToolbarItem(placement: .cancellationAction) {
                    Button("Cancel") {
                        dismiss()
                    }
                }
                
                ToolbarItem(placement: .confirmationAction) {
                    Button("Update") {
                        updateShelf()
                    }
                    .disabled(!isFormValid || isLoading)
                }
            }
            .alert("Error", isPresented: $showError) {
                Button("OK", role: .cancel) { }
            } message: {
                Text(errorMessage ?? "An error occurred")
            }
        }
    }
    
    private var isFormValid: Bool {
        !name.isEmpty
    }
    
    private func updateShelf() {
        isLoading = true
        Task {
            do {
                try await supabase.updateShelf(id: shelf.id, name: name)
                onUpdate()
                dismiss()
            } catch {
                errorMessage = error.localizedDescription
                showError = true
            }
            isLoading = false
        }
    }
}

// MARK: - Helper View: Move to Shelf

struct MoveToShelfView: View {
    let book: Book
    let shelves: [Shelf]
    let onMove: () -> Void
    
    @StateObject private var supabase = SupabaseService.shared
    @State private var selectedShelfId: UUID
    @State private var isLoading = false
    @State private var errorMessage: String?
    @State private var showError = false
    @Environment(\.dismiss) private var dismiss
    
    init(book: Book, shelves: [Shelf], onMove: @escaping () -> Void) {
        self.book = book
        self.shelves = shelves
        self.onMove = onMove
        _selectedShelfId = State(initialValue: book.shelfId)
    }
    
    var body: some View {
        NavigationStack {
            List {
                ForEach(shelves) { shelf in
                    Button {
                        selectedShelfId = shelf.id
                    } label: {
                        HStack {
                            Text(shelf.name)
                                .foregroundStyle(.primary)
                            Spacer()
                            if shelf.id == selectedShelfId {
                                Image(systemName: "checkmark")
                                    .foregroundStyle(.blue)
                            }
                        }
                    }
                }
            }
            .navigationTitle("Move to Shelf")
            .navigationBarTitleDisplayMode(.inline)
            .toolbar {
                ToolbarItem(placement: .cancellationAction) {
                    Button("Cancel") {
                        dismiss()
                    }
                }
                
                ToolbarItem(placement: .confirmationAction) {
                    Button("Move") {
                        moveBook()
                    }
                    .disabled(selectedShelfId == book.shelfId || isLoading)
                }
            }
            .alert("Error", isPresented: $showError) {
                Button("OK", role: .cancel) { }
            } message: {
                Text(errorMessage ?? "An error occurred")
            }
        }
    }
    
    private func moveBook() {
        isLoading = true
        Task {
            do {
                try await supabase.updateBook(
                    id: book.id,
                    title: book.title,
                    author: book.author,
                    shelfId: selectedShelfId
                )
                onMove()
                dismiss()
            } catch {
                errorMessage = error.localizedDescription
                showError = true
            }
            isLoading = false
        }
    }
}

// MARK: - Previews

#Preview("Shelves List") {
    ShelvesListView()
}

#Preview("Add Shelf") {
    AddShelfView(onSave: {})
}
```
